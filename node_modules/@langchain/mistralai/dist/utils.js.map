{"version":3,"file":"utils.js","names":["toolCallId: string","num: number","arr: string[]","str: string","content: string | MistralAIContentChunk[] | null | undefined"],"sources":["../src/utils.ts"],"sourcesContent":["import { ContentChunk as MistralAIContentChunk } from \"@mistralai/mistralai/models/components/contentchunk.js\";\nimport { MessageContentComplex } from \"@langchain/core/messages\";\n\n// Mistral enforces a specific pattern for tool call IDs\nconst TOOL_CALL_ID_PATTERN = /^[a-zA-Z0-9]{9}$/;\n\nexport function _isValidMistralToolCallId(toolCallId: string): boolean {\n  return TOOL_CALL_ID_PATTERN.test(toolCallId);\n}\n\nfunction _base62Encode(num: number): string {\n  let numCopy = num;\n  const base62 =\n    \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n  if (numCopy === 0) return base62[0];\n  const arr: string[] = [];\n  const base = base62.length;\n  while (numCopy) {\n    arr.push(base62[numCopy % base]);\n    numCopy = Math.floor(numCopy / base);\n  }\n  return arr.reverse().join(\"\");\n}\n\nfunction _simpleHash(str: string): number {\n  let hash = 0;\n  for (let i = 0; i < str.length; i += 1) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash &= hash; // Convert to 32-bit integer\n  }\n  return Math.abs(hash);\n}\n\nexport function _convertToolCallIdToMistralCompatible(\n  toolCallId: string\n): string {\n  if (_isValidMistralToolCallId(toolCallId)) {\n    return toolCallId;\n  } else {\n    const hash = _simpleHash(toolCallId);\n    const base62Str = _base62Encode(hash);\n    if (base62Str.length >= 9) {\n      return base62Str.slice(0, 9);\n    } else {\n      return base62Str.padStart(9, \"0\");\n    }\n  }\n}\n\nexport function _mistralContentChunkToMessageContentComplex(\n  content: string | MistralAIContentChunk[] | null | undefined\n): string | MessageContentComplex[] {\n  if (!content) {\n    return \"\";\n  }\n  if (typeof content === \"string\") {\n    return content;\n  }\n  return content.map((contentChunk) => {\n    // Only Mistral ImageURLChunks need conversion to MessageContentComplex\n    if (contentChunk.type === \"image_url\") {\n      if (\n        typeof contentChunk.imageUrl !== \"string\" &&\n        contentChunk.imageUrl?.detail\n      ) {\n        const { detail } = contentChunk.imageUrl;\n        // Mistral detail can be any string, but MessageContentComplex only supports\n        // detail to be \"high\", \"auto\", or \"low\"\n        if (detail !== \"high\" && detail !== \"auto\" && detail !== \"low\") {\n          return {\n            type: contentChunk.type,\n            image_url: {\n              url: contentChunk.imageUrl.url,\n            },\n          };\n        }\n      }\n      return {\n        type: contentChunk.type,\n        image_url: contentChunk.imageUrl,\n      };\n    }\n    return contentChunk;\n  });\n}\n"],"mappings":";AAIA,MAAM,uBAAuB;AAE7B,SAAgB,0BAA0BA,YAA6B;AACrE,QAAO,qBAAqB,KAAK,WAAW;AAC7C;AAED,SAAS,cAAcC,KAAqB;CAC1C,IAAI,UAAU;CACd,MAAM,SACJ;AACF,KAAI,YAAY,EAAG,QAAO,OAAO;CACjC,MAAMC,MAAgB,CAAE;CACxB,MAAM,OAAO;AACb,QAAO,SAAS;EACd,IAAI,KAAK,OAAO,UAAU,MAAM;EAChC,UAAU,KAAK,MAAM,UAAU,KAAK;CACrC;AACD,QAAO,IAAI,SAAS,CAAC,KAAK,GAAG;AAC9B;AAED,SAAS,YAAYC,KAAqB;CACxC,IAAI,OAAO;AACX,MAAK,IAAI,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK,GAAG;EACtC,MAAM,OAAO,IAAI,WAAW,EAAE;EAC9B,QAAQ,QAAQ,KAAK,OAAO;EAC5B,QAAQ;CACT;AACD,QAAO,KAAK,IAAI,KAAK;AACtB;AAED,SAAgB,sCACdH,YACQ;AACR,KAAI,0BAA0B,WAAW,CACvC,QAAO;MACF;EACL,MAAM,OAAO,YAAY,WAAW;EACpC,MAAM,YAAY,cAAc,KAAK;AACrC,MAAI,UAAU,UAAU,EACtB,QAAO,UAAU,MAAM,GAAG,EAAE;MAE5B,QAAO,UAAU,SAAS,GAAG,IAAI;CAEpC;AACF;AAED,SAAgB,4CACdI,SACkC;AAClC,KAAI,CAAC,QACH,QAAO;AAET,KAAI,OAAO,YAAY,SACrB,QAAO;AAET,QAAO,QAAQ,IAAI,CAAC,iBAAiB;AAEnC,MAAI,aAAa,SAAS,aAAa;AACrC,OACE,OAAO,aAAa,aAAa,YACjC,aAAa,UAAU,QACvB;IACA,MAAM,EAAE,QAAQ,GAAG,aAAa;AAGhC,QAAI,WAAW,UAAU,WAAW,UAAU,WAAW,MACvD,QAAO;KACL,MAAM,aAAa;KACnB,WAAW,EACT,KAAK,aAAa,SAAS,IAC5B;IACF;GAEJ;AACD,UAAO;IACL,MAAM,aAAa;IACnB,WAAW,aAAa;GACzB;EACF;AACD,SAAO;CACR,EAAC;AACH"}